<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ict.teamProject.notic.NoticMapper">	
	<select id="findAllNotic" resultType="NoticDto" parameterType="String">
		SELECT * FROM 
		(			
			SELECT ts.*, c.BBS_NO, b.BBS_CONTENT, c.CCOMMENT, c.PARENT_COMMENT, p.PRO_FILEPATH FROM 
				(
					SELECT * FROM notic WHERE notic_receive_user = #{id} AND NOTIC_TYPE = 1
				) ts 
				JOIN COMMENTLINE c ON ts.TRIGGER_NO = c.C_NO
				JOIN BBS b ON c.bbs_no = b.bbs_no
				JOIN PROFILE p ON ts.NOTIC_TRIGGER_USER = p.ID
			
			UNION ALL 
			
			SELECT ts.*, NULL AS BBS_NO, b.BBS_CONTENT, NULL AS CCOMMENT, NULL AS PARENT_COMMENT, p.PRO_FILEPATH FROM 
				(
					SELECT * FROM notic WHERE notic_receive_user = #{id} AND NOTIC_TYPE = 2
				) ts 
				JOIN BBS b ON ts.TRIGGER_NO = b.BBS_NO
				JOIN PROFILE p ON ts.NOTIC_TRIGGER_USER = p.ID
		) 
		ORDER BY notic_trigger_date DESC
	</select>
	<update id="updateNotic" parameterType="Int">
		UPDATE NOTIC SET CHECKED_TIME = CURRENT_TIMESTAMP WHERE TRIGGER_PK = #{trigger_pk}
	</update>
	
	<delete id="deleteNotic" parameterType="Int"> 	
		DELETE FROM NOTIC WHERE trigger_pk = #{trigger_no}
	</delete>
</mapper>